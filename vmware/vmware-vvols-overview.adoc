---
sidebar: sidebar 
permalink: vmware/vmware-vvols-overview.html 
keywords: tr-4400, vvols, ontap, virtual volumes 
summary: 'Esta es una descripción general de VMware vSphere Virtual Volumes (vVols) con ONTAP' 
---
= Descripción general
:allow-uri-read: 
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ../media/


[role="lead"]
ONTAP ha sido una solución de almacenamiento líder para entornos VMware vSphere durante más de dos décadas y continúa añadiendo funcionalidades innovadoras para simplificar la gestión al tiempo que reduce los costes.

Este documento trata las funcionalidades de ONTAP para VMware vSphere Virtual Volumes (vVols), incluida la información más reciente sobre el producto y los casos de uso, junto con las prácticas recomendadas y otra información para optimizar la puesta en marcha y reducir los errores.


NOTE: Esta documentación sustituye a los informes técnicos _TR-4400 publicados previamente: VMware vSphere Virtual Volumes (vVols) con ONTAP_

Las prácticas recomendadas complementan otros documentos, como guías y listas de compatibilidad. Se desarrollan según pruebas de laboratorio y una amplia experiencia de campo por parte de ingenieros y clientes de NetApp. Puede que no sean las únicas prácticas que funcionan o son compatibles, pero generalmente son las soluciones más simples que satisfacen las necesidades de la mayoría de los clientes.


NOTE: Este documento se ha actualizado para incluir las nuevas funciones de vVols que se encuentran en vSphere 8,0 update 3, el lanzamiento de ONTAP tools 10,4 y los nuevos sistemas NetApp ASA.



== Información general sobre Virtual Volumes (vVols)

NetApp comenzó trabajando con VMware para dar soporte a las API vSphere de Storage Awareness (VASA) para vSphere 5 en 2012. Este primer proveedor de VASA permitía definir las capacidades de almacenamiento en un perfil que podía utilizarse para filtrar almacenes de datos al aprovisionar y comprobar después el cumplimiento de la política. Con el tiempo, esta evolución evolucionó y se añadieron nuevas funcionalidades que permitían una mayor automatización en el aprovisionamiento, y nuevos volúmenes virtuales o vVols, donde se utilizan objetos de almacenamiento individuales para archivos de máquinas virtuales y discos virtuales. Estos objetos podrían ser LUN, archivos y ahora con espacios de nombres vSphere 8 - NVMe (se utiliza con las herramientas de ONTAP 9.13P2). NetApp colaboró estrechamente con VMware como partner de referencia para vVols lanzado con vSphere 6 en 2015 y de nuevo como partner de diseño para vVols utilizando NVMe over Fabrics en vSphere 8. NetApp sigue mejorando vVols para aprovechar las últimas funcionalidades de ONTAP.

Hay varios componentes a tener en cuenta:



=== Proveedor de VASA

Este es el componente de software que gestiona la comunicación entre VMware vSphere y el sistema de almacenamiento. Para ONTAP, VASA Provider se ejecuta en un dispositivo conocido como herramientas de ONTAP para VMware vSphere (herramientas de ONTAP para abreviar). Las herramientas de ONTAP también incluyen un complemento para vCenter, un adaptador de replicación de almacenamiento (SRA) para el administrador de recuperación de sitio de VMware y un servidor API de REST para crear su propia automatización. Una vez que las herramientas de ONTAP se han configurado y registrado con vCenter, ya no es necesario interactuar directamente con el sistema ONTAP, ya que casi todas sus necesidades de almacenamiento pueden gestionarse desde la interfaz de usuario de vCenter o mediante la automatización de la API de REST.



=== Extremo de protocolo (PE)

El extremo de protocolo es un proxy para I/O entre los hosts ESXi y el almacén de datos vVols. El proveedor VASA de ONTAP crea estos automáticamente, ya sea un LUN de extremo de protocolo (4MB TB de tamaño) por volumen FlexVol del almacén de datos vVols, o un punto de montaje de NFS por interfaz NFS (LIF) en el nodo de almacenamiento que aloja un volumen FlexVol en el almacén de datos. El host ESXi monta estos extremos de protocolo de forma directa en lugar de LUN VVol individuales y archivos de disco virtual. No es necesario gestionar los extremos de protocolo, ya que el proveedor VASA los crea, monta, desmonta y elimina automáticamente, junto con los grupos de interfaces necesarios o las políticas de exportación.



=== Extremo de protocolo virtual (VPE)

Como novedad en vSphere 8, cuando se usa NVMe over Fabrics (NVMe-oF) con vVols, el concepto de extremo de protocolo ya no es relevante en ONTAP. En su lugar, el host ESXi crea una instancia de PE virtual automáticamente para cada grupo ANA en cuanto se enciende la primera máquina virtual. ONTAP crea automáticamente grupos ANA para cada volumen de FlexVol que usa el almacén de datos.

Otra ventaja de usar NVMe-oF para vVols es que no hay solicitudes de enlace requeridas del proveedor VASA. En su lugar, el host ESXi gestiona la funcionalidad de vinculación de VVol internamente según VPE. Esto reduce la posibilidad de que un enlace masivo de VVOL afecte al servicio.

Para obtener más información, consulte https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-storage/GUID-23B47AAC-6A31-466C-84F9-8CF8F1CDD149.html["NVMe y Virtual Volumes"^] encendido https://docs.vmware.com/en/VMware-vSphere/8.0/vsphere-storage/GUID-23B47AAC-6A31-466C-84F9-8CF8F1CDD149.html["vmware.com"^]



=== Almacén de datos de volúmenes virtuales

El almacén de datos de volumen virtual es una representación lógica del almacén de datos de un contenedor vVols , que es creado y mantenido por un proveedor de VASA. El contenedor representa un grupo de capacidad de almacenamiento aprovisionado desde sistemas de almacenamiento administrados por el proveedor de VASA. Las herramientas ONTAP admiten la asignación de múltiples volúmenes FlexVol (denominados volúmenes de respaldo) a un único almacén de datos vVols , y estos almacenes de datos vVols pueden abarcar varios nodos en un clúster ONTAP , combinando sistemas flash e híbridos con diferentes capacidades. El administrador puede crear nuevos volúmenes FlexVol utilizando el asistente de aprovisionamiento o la API REST, o seleccionar volúmenes FlexVol creados previamente para el almacenamiento de respaldo si están disponibles.



=== Volúmenes virtuales (vVols)

Los vVols son los archivos y discos de la máquina virtual reales almacenados en el almacén de datos de vVols . El uso del término vVol (singular) se refiere a un solo archivo, LUN o espacio de nombres específico. ONTAP crea espacios de nombres NVMe, LUN o archivos según el protocolo que utilice el almacén de datos. Hay varios tipos distintos de vVols; los más comunes son Config (el único con VMFS, contiene archivos de metadatos como el archivo VMX de la VM), Data (disco virtual o VMDK) y Swap (creado cuando se enciende la VM). Los vVols protegidos por el cifrado de VM de VMware serán del tipo Otro. El cifrado de máquinas virtuales de VMware no debe confundirse con el cifrado de volumen o agregado de ONTAP .



== Gestión basada en políticas

Las API de VMware vSphere para Storage Awareness (VASA) facilitan que un administrador de máquinas virtuales utilice las capacidades de almacenamiento necesarias para aprovisionar máquinas virtuales sin tener que interactuar con su equipo de almacenamiento. Antes de VASA, los administradores de VM podían definir políticas de almacenamiento de VM, pero tenían que trabajar con sus administradores de almacenamiento para identificar almacenes de datos apropiados, a menudo mediante documentación o convenciones de nomenclatura. Con VASA, los administradores de vCenter con los permisos adecuados pueden definir una variedad de capacidades de almacenamiento que los usuarios de vCenter pueden usar para aprovisionar máquinas virtuales. La asignación entre la política de almacenamiento de VM y las capacidades del almacén de datos permite a vCenter mostrar una lista de almacenes de datos compatibles para su selección, además de permitir que otras tecnologías como VCF (anteriormente conocido como Aria y vRealize) Automation o VMware vSphere Kubernetes Service (VKS) seleccionen automáticamente el almacenamiento de una política asignada. Este enfoque se conoce como gestión basada en políticas de almacenamiento. Si bien las reglas del proveedor VASA y las políticas de almacenamiento de VM también se pueden usar con almacenes de datos tradicionales, aquí nos centraremos en los almacenes de datos vVols .



=== Políticas de almacenamiento de máquinas virtuales

Las políticas de almacenamiento de máquinas virtuales se crean en vCenter en Políticas y perfiles. Para vVols, cree un conjunto de reglas mediante reglas del proveedor de tipo de almacenamiento de NetApp vVols. Las herramientas de ONTAP 10.X ofrecen ahora un método más sencillo que las herramientas de ONTAP 9.X, ya que le permiten especificar directamente los atributos de almacenamiento en la normativa de almacenamiento de las máquinas virtuales misma.

Como se ha mencionado anteriormente, el uso de políticas puede ayudar a simplificar la tarea de aprovisionar un equipo virtual o VMDK. Solo tiene que seleccionar una política adecuada y VASA Provider mostrará los almacenes de datos de vVols compatibles con esa política y colocará el VVOL en una FlexVol volume individual que cumpla las normativas.



=== Puesta en marcha de equipos virtuales mediante políticas de almacenamiento

image::vvols-image3.png[Ponga en marcha equipos virtuales mediante la normativa de almacenamiento,800,480]

Una vez que se aprovisiona una máquina virtual, el proveedor VASA continuará verificando el cumplimiento y alertará al administrador de la máquina virtual con una alarma en vCenter cuando el volumen de respaldo ya no cumpla con la política.



=== Cumplimiento de políticas de almacenamiento de máquinas virtuales

image::vvols-image4.png[Cumplimiento de la política de almacenamiento de máquinas virtuales,320,100]



== Compatibilidad con NetApp vVols

ONTAP ha admitido la especificación VASA desde su lanzamiento inicial en 2012. Si bien otros sistemas de almacenamiento de NetApp pueden admitir VASA, este documento se centra en las versiones actualmente compatibles de ONTAP 9.



=== ONTAP

Además de ONTAP 9 en sistemas AFF, ASA y FAS , NetApp admite cargas de trabajo de VMware en ONTAP Select, Amazon FSx para NetApp con VMware Cloud en AWS, Azure NetApp Files con Azure VMware Solution, Google Cloud NetApp Volumes con Google Cloud VMware Engine y NetApp Private Storage en Equinix, pero la funcionalidad específica puede variar según el proveedor de servicios y la conectividad de red disponible.

Al momento de la publicación, los entornos de hiperescalador están limitados únicamente a almacenes de datos NFS v3 tradicionales; por lo tanto, los vVols solo están disponibles con sistemas ONTAP locales o sistemas conectados a la nube que ofrecen la funcionalidad completa de un sistema local, como aquellos alojados por socios de NetApp y proveedores de servicios en todo el mundo.

_Para obtener más información sobre ONTAP, consulte https://docs.netapp.com/us-en/ontap-family/["Documentación de productos de ONTAP"^]_

_Para obtener más información acerca de las prácticas recomendadas para ONTAP y VMware vSphere, consulte link:vmware-vsphere-overview.html["CONSULTE TR-4597"^]_



== Ventajas del uso de vVols con ONTAP

Cuando VMware introdujo el soporte de vVols con VASA 2.0 en 2015, lo describieron como "un marco de integración y gestión que ofrece un nuevo modelo operativo para almacenamiento externo (SAN/NAS)". Este modelo operativo ofrece varios beneficios junto con el almacenamiento ONTAP .



=== Gestión basada en políticas

Como se explica en la sección 1.2, la administración basada en políticas permite aprovisionar máquinas virtuales y luego administrarlas mediante políticas predefinidas. Esto puede ayudar a las operaciones de TI de varias maneras:

* *Aumentar la velocidad.* Las herramientas de ONTAP eliminan la necesidad de que el administrador de vCenter abra tickets con el equipo de almacenamiento para actividades de aprovisionamiento de almacenamiento. Sin embargo, los roles RBAC de las herramientas ONTAP en vCenter y en el sistema ONTAP aún permiten equipos independientes (como equipos de almacenamiento) o actividades independientes del mismo equipo, al restringir el acceso a funciones específicas si así se desea.
* * Provisionamiento más inteligente. * Las capacidades del sistema de almacenamiento se pueden exponer a través de las API de VASA, lo que permite que los flujos de trabajo de aprovisionamiento aprovechen las capacidades avanzadas sin que el administrador de VM tenga que entender cómo administrar el sistema de almacenamiento.
* * Provisionamiento más rápido.* Se pueden admitir diferentes capacidades de almacenamiento en un único almacén de datos y seleccionarlas automáticamente según sea apropiado para una VM basada en la política de VM.
* *Evite errores.* Las políticas de almacenamiento y VM se desarrollan con anticipación y se aplican según sea necesario sin tener que personalizar el almacenamiento cada vez que se aprovisiona una VM. Las alarmas de cumplimiento de normativas se generan cuando las funcionalidades de almacenamiento van más allá de las políticas definidas. Como se ha mencionado anteriormente, los SCPs hacen que el aprovisionamiento inicial sea predecible y repetible, mientras que basar las políticas de almacenamiento de los equipos virtuales en los SCPs garantiza una ubicación precisa.
* * Mejor gestión de la capacidad.* Las herramientas VASA y ONTAP permiten ver la capacidad de almacenamiento hasta el nivel de agregado individual si es necesario y proporcionar varias capas de alerta en caso de que la capacidad empiece a ser baja.




=== Gestión granular de máquinas virtuales en el SAN moderno

Los sistemas de almacenamiento SAN que utilizan Fibre Channel e iSCSI fueron los primeros en recibir soporte de VMware para ESX, pero carecían de la capacidad de administrar archivos y discos de VM individuales desde el sistema de almacenamiento. En su lugar, se aprovisionan los LUN y VMFS administra los archivos individuales. Esto dificulta que el sistema de almacenamiento administre directamente el rendimiento, la clonación y la protección del almacenamiento de cada máquina virtual individual. vVols aporta una granularidad de almacenamiento que los clientes que utilizan almacenamiento NFS ya disfrutan, con las capacidades SAN robustas y de alto rendimiento de ONTAP.

Ahora, con vSphere 8 y las ONTAP tools for VMware vSphere 9.12 y versiones posteriores, esos mismos controles granulares utilizados por vVols para protocolos heredados basados ​​en SCSI ahora están disponibles en la SAN de canal de fibra moderna que utiliza NVMe sobre Fabrics para un rendimiento aún mayor a escala. Con vSphere 8.0 update 1, ahora es posible implementar una solución NVMe completa de extremo a extremo utilizando vVols sin ninguna traducción de E/S en la pila de almacenamiento del hipervisor.



=== Mayor capacidad de descarga de soluciones de almacenamiento

Si bien VAAI ofrece una variedad de operaciones que se descargan en el almacenamiento, existen algunas brechas que el proveedor VASA aborda. SAN VAAI no puede descargar instantáneas administradas por VMware al sistema de almacenamiento. NFS VAAI puede descargar instantáneas administradas por VM, pero existen limitaciones en una VM con instantáneas nativas de almacenamiento. Dado que vVols usa LUN individuales, espacios de nombres o archivos para discos de máquinas virtuales, ONTAP puede clonar de manera rápida y eficiente los archivos o LUN para crear instantáneas granulares de VM que ya no requieren archivos delta. NFS VAAI tampoco admite la descarga de operaciones de clonación para migraciones de Storage vMotion en caliente (encendido). La máquina virtual debe estar apagada para permitir la descarga de la migración cuando se utiliza VAAI con almacenes de datos NFS tradicionales. El proveedor VASA en las herramientas ONTAP permite realizar clones casi instantáneos y con uso eficiente del almacenamiento para migraciones en caliente y en frío, y también admite copias casi instantáneas para migraciones entre volúmenes de vVols. Debido a estos importantes beneficios de eficiencia de almacenamiento, es posible que pueda aprovechar al máximo las cargas de trabajo de vVols en https://www.netapp.com/pdf.html?item=/media/8207-flyer-efficiency-guaranteepdf.pdf["Garantía de eficiencia"] programa. Del mismo modo, si los clones entre volúmenes que utilizan VAAI no satisfacen sus requisitos, probablemente podrá resolver su desafío comercial gracias a las mejoras en la experiencia de copia con vVols.



=== Casos de uso comunes para vVols

Además de estos beneficios, también se observan estos casos de uso comunes para el almacenamiento de VVOL:

* *Provisionamiento bajo demanda de VMs*
+
** Cloud privado o IaaS de proveedor de servicios.
** Aproveche la automatización y la orquestación a través del paquete Aria (anteriormente vRealize), OpenStack, etc.


* *Discos de primera clase (FCDs)*
+
** Volúmenes persistentes de VMware vSphere Kubernetes Service (VKS).
** Proporcione servicios similares a Amazon EBS a través de la gestión del ciclo de vida de VMDK independiente.


* *Provisionamiento bajo demanda de VMs temporales*
+
** Laboratorios de prueba/desarrollo
** Entornos de formación






=== Beneficios comunes con vVols

Cuando se utiliza a su máximo beneficio, como en los casos de uso anteriores, vVols proporciona las siguientes mejoras específicas:

* Los clones se crean rápidamente dentro de un solo volumen o en varios volúmenes en un clúster ONTAP , lo que constituye una ventaja en comparación con los clones tradicionales habilitados para VAAI. También son eficientes en cuanto al almacenamiento. Los clones dentro de un volumen utilizan la clonación de archivos ONTAP , que son como los volúmenes FlexClone y solo almacenan los cambios del archivo/LUN/espacio de nombres vVol de origen. De este modo, las máquinas virtuales a largo plazo para producción u otros fines de aplicación se crean rápidamente, ocupan un espacio mínimo y pueden beneficiarse de la protección a nivel de máquina virtual (utilizando el complemento NetApp SnapCenter para VMware vSphere, instantáneas administradas por VMware o respaldo VADP) y la administración del rendimiento (con ONTAP QoS). Los clones entre volúmenes son mucho más rápidos con vVols que con VAAI porque con VASA podemos crear el clon y permitir el acceso a él en el destino antes de que se complete la copia. Los bloques de datos se copian como un proceso en segundo plano para completar el vVol de destino. Esto es similar a la forma en que funciona el movimiento de LUN no disruptivo de ONTAP para los LUN tradicionales.
* Los vVols son la tecnología de almacenamiento ideal cuando se utiliza TKG con vSphere CSI, lo que proporciona capacidades y clases de almacenamiento discretas gestionadas por el administrador de vCenter.
* Los servicios similares a Amazon EBS se pueden entregar a través de FCD porque un FCD VMDK, como sugiere el nombre, es un ciudadano de primera clase en vSphere y tiene un ciclo de vida que se puede administrar de forma independiente, separado de las máquinas virtuales a las que puede estar conectado.

